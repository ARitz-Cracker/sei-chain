- name: Test place, query and cancel a new order
  inputs:
    # Get contract address, this requires contract already deployed
    - cmd: tail -1 integration_test/contracts/mars-addr.txt
      env: CONTRACT_ADDR
    # Prepare limit parameter
    - cmd: echo "LONG?1.01?5?SEI?ATOM?LIMIT?{\"leverage\":\"1\",\"position_effect\":\"Open\"}"
      env: PLACE_ORDER_PARAMS
    # Place an order and set ORDER_ID
    - cmd: printf "12345678\n" | seid tx dex place-orders $CONTRACT_ADDR $PLACE_ORDER_PARAMS --amount=1000000000usei -y --from=admin --chain-id=sei --fees=1000000usei --gas=50000000 --broadcast-mode=block --output json|jq -M -r ".logs[].events[].attributes[] | select(.key == \"order_id\").value"
      env: ORDER_ID
    # Query the order by id
    - cmd: seid q dex get-orders-by-id $CONTRACT_ADDR SEI ATOM $ORDER_ID --output json |jq .order.status
      env: PLACE_ORDER_RESULT
    # Prepare limit parameter
    - cmd: echo "1?LONG?1.01?5?SEI?ATOM?LIMIT"
      env: CANCEL_ORDER_PARAMS
    # Count before cancel
    # Cancel the order
    - cmd: printf "12345678\n" | seid tx dex cancel-orders $CONTRACT_ADDR $CANCEL_ORDER_PARAMS -y --from=admin --chain-id=sei --fees=1000000usei --gas=50000000 --broadcast-mode=block --output json
    # Query the order by id
    - cmd: seid q dex get-orders-by-id $CONTRACT_ADDR SEI ATOM $ORDER_ID --output json |jq .order.status
      env: CANCEL_ORDER_RESULT
  verifiers:
    # Order id should be greater or equal to 0
    - type: eval
      expr: ORDER_ID >= 0
    # Order status should be something like PLACED
    - type: regex
      result: PLACE_ORDER_RESULT
      expr: '^.*PLACED.*'
    # Order status should be something like CANCELLED
    - type: regex
      result: CANCEL_ORDER_RESULT
      expr: '^.*PLACED.*'



  printf "12345678\n" | seid tx dex cancel-orders sei14hj2tavq8fpesdwxxcu44rty3hh90vhujrvcmstl4zr3txmfvw9sh9m79m "0?LONG?1.01?SEI?ATOM?LIMIT" -y --from admin --chain-id sei  --fees=1000000usei --gas=50000000 --broadcast-mode=block